# Cargo configuration for vjson
# Optimized for maximum performance on modern CPUs

# Enable link-time optimization for release builds
[profile.release]
lto = "thin"           # Thin LTO for faster compile times with good optimization
codegen-units = 1      # Single codegen unit for better optimization
opt-level = 3          # Maximum optimization
strip = true           # Strip debug symbols from binary

# Profile for benchmarks (same as release but with debug info)
[profile.bench]
lto = "thin"
codegen-units = 1
opt-level = 3
debug = true

# Development profile - faster compile times
[profile.dev]
opt-level = 1          # Some optimization for reasonable dev performance
debug = true

# Target-specific optimizations
# Uncomment for native CPU optimization (not portable!)
# [build]
# rustflags = ["-C", "target-cpu=native"]

# macOS-specific settings for Apple Silicon
[target.aarch64-apple-darwin]
rustflags = [
    "-C", "target-feature=+neon",  # Enable NEON SIMD
]

# x86_64 settings (Intel/AMD)
[target.x86_64-unknown-linux-gnu]
rustflags = [
    "-C", "target-feature=+avx2,+fma",  # Enable AVX2 and FMA
]

[target.x86_64-apple-darwin]
rustflags = [
    "-C", "target-feature=+avx2,+fma",  # Enable AVX2 and FMA
]

# Windows x86_64
[target.x86_64-pc-windows-msvc]
rustflags = [
    "-C", "target-feature=+avx2,+fma",
]

# Alias for common commands
[alias]
b = "build --release"
t = "test"
c = "clippy --all-features -- -D warnings"
fmt-check = "fmt -- --check"
